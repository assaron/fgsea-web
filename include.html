<div id="popup1" class="overlay">
    <div class="popup">
        <p id="caption"></p>
        <a class="close">&times;</a>
        <img id="plot" class="modal-content" onerror="imgError(this)">
    </div>
</div>
<script>
var modal = document.getElementById('popup1');
var closebtn = document.getElementsByClassName('close')[0];

var imageLinks = {};

btnclick = function(pathway) {
    document.getElementById('plot').pathway = pathway;
    if (imageLinks[pathway] == null) {
        document.getElementById('plot').src = "some_placeholder_image_dunno";
        sendPathway(pathway);
    } else {
        document.getElementById('plot').src = imageLinks[pathway];
        //TODO: add loader animation
    }
    document.getElementById('caption').innerHTML = pathway;
    modal.style.display = "inline-block";
}

closebtn.onclick = function() {
    modal.style.display = "none";
}
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

function imgError(image) {
    image.onerror = null;
    setTimeout(function() {
        image.src = image.src;
    }, 3000);
}

sendPathway = function(pathway) {
    Shiny.onInputChange("pathway", pathway);
}

Shiny.addCustomMessageHandler("imageReady",
    function(msg) {
        imageLinks[msg["pathway"]] = msg["link"];
        document.getElementById("plot").src = imageLinks[document.getElementById('plot').pathway];
    });
</script>
